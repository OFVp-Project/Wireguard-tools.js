name: wginterface
flags:
  - "!-fno-exceptions"
  - "-fpermissive"
  - "-fexceptions"
  - "-w"
  - "-fpermissive"
flagsCC:
  - "!-fno-exceptions"
  - "-fpermissive"
  - "-fexceptions"
  - "-w"
  - "-fpermissive"
defines:
  - "NAPI_DISABLE_CPP_EXCEPTIONS"
  - "NODE_VERSION=4"
includes:
  - addons/genKey
  - addons/tools
  - node_modules/node-addon-api
sources:
  - "addons/genKey/wgkeys.cpp"
  - "addons/tools/wginterface.cpp"
  - "addons/tools/wginterface-dummy.cpp"
target:
  macos:
    defines:
      - USERSPACE_GO
  linux:
    sources:
      - "addons/tools/linux/wireguard.c"
      - "addons/tools/wginterface-linux.cpp"
      - "!addons/tools/wginterface-dummy.cpp"
    defines:
      - "LISTDEV"
      - "GETCONFIG"
      - "SETCONFIG"
      - "DELIFACE"
    target:
      x86_64:
        release: true
        flags:
          - "-fPIC"
        flagsCC:
          - "-fPIC"
      aarch64:
        release: true
        flags:
          - "-fPIC"
        flagsCC:
          - "-fPIC"
  windows:
    flags:
      - "-undefined"
      - "dynamic_lookup"
    target:
      x86_64:
        release: true
      aarch64:
        release: true
    sources:
      - "addons/tools/wginterface-win.cpp"
      - "!addons/tools/wginterface-dummy.cpp"
    includes:
      - "addons/tools/win"
    defines:
      - "ONSTARTADDON"
      - "LISTDEV"
      - "GETCONFIG"
      - "SETCONFIG"
      - "DELIFACE"
      - "_HAS_EXCEPTIONS=1"
    libraries:
      - "bcrypt.lib"
      - "crypt32.lib"
      - "iphlpapi.lib"
      - "kernel32.lib"
      - "ntdll.lib"
      - "ws2_32.lib"
      - "setupapi.lib"